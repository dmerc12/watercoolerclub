<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Job Post</title>
</head>
<body>
    <h1>Create Your Job Post Below!</h1><br>
    <h3>Enter the job ID:</h3><input id="jobIdInput" type="number"><br>
    <h3>Enter the job title:</h3><input id="jobTitleInput" type="text"><br>
    <h3>Enter the job type: </h3><input id="jobTypeInput" type="text"><br>
    <h3>Enter the job description:</h3><input id="jobDescriptionInput" type="text"><br>
    <h3>Enter the company ID:</h3><input id="companyIdInput" type="number">
    <h3>Enter the job location:</h3><input id="jobLocationInput" type="text"><br>
    <h3>Enter the Company name:</h3><input id="companyNameInput" type="text"><br>
    <button id="postJobButton" onclick="createJobPost()">Post</button><button id="buttonToReturnToHomeFromCreateJobPost">Go back</button>

</body>
<script>
    // attmepting to pull company id from login so that they do not need to input it.
    // need to figure out how to set jobId to incriment and does not have to be set.
    /* const companyId = window.sessionStorage.getItem("token").split("Id").pop();

    if(!window.sessionStorage.getItem("token")){
        swal.fire({
            title: 'You should not be here!',
            confirmButtonText: 'Continue to log in. . .'
        }).then(function(result) {
            if (result.isConfirmed) {
                window.location.href=""
            }
        });
    } */

    function resetInputs(){
        document.getElementById("jobId").value="";
        document.getElementById("title").value="";
        document.getElementById("type").value="";
        document.getElementById("description").value="";
        document.getElementById("companyId").value="";
        document.getElementById("location").value="";
        document.getElementById("companyName").value=""
    }

    async function createJobPost(){
        const jobId = document.getElementById("jobId").value;
        const title = document.getElementById("title").value;
        const type = document.getElementById("type").value;
        const description = document.getElementById("description").value;
        const companyId = document.getElementById("companyId").value;
        const location = document.getElementById("location").value;
        const companyName = document.getElementById("companyName").value;
        createJobPostJSON  = {
            'jobId': jobId,
            'title': title,
            'type': type,
            'description': description,
            'companyId': companyId,
            // if tokens are created at the login the below code can be uncommented
            //'token': window.sessionStorage.getItem("token"),
            'location': location,
            'companyName': companyName
        }
        let sendJobPost = {
            method: "POST",
            headers: {'Content-Type': "application/json"},
            body: JSON.stringify(createJobPostJSON)
        }
        const response = await fetch(apiURL, sendJobPost);
        if (response.status === 200) {
            const apiResponse = await response.json();
            swal.fire({
                title: 'Job post successfully generated with the job ID number of ' + String(apiResponse.jobId),
                confirmButtonText: 'Continue'
            }).then(function(result) {
                if (result.isConfirmed) {
                    resetInputs();
                }
            });
        } else if (response.status === 400) {
            const apiResponse = await response.json();
            swal.fire(
                "Could not create job post. . . ",
                apiResponse.message,
                "error"
            );
            resetInputs();
        } else {
            swal(
                "Something really, really, really bad happened. . .",
                "Please try again.",
                "error"
            );
        }
    }
</script>
</html>